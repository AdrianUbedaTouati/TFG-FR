{% extends 'base.html' %}

{% block title %}Panel de Control - MeteoIA{% endblock %}

{% block extra_css %}
<style>
    .dashboard-card {
        height: 100%;
        transition: transform 0.3s ease;
    }
    .dashboard-card:hover {
        transform: translateY(-5px);
    }
    .metric-value {
        font-size: 2.5rem;
        font-weight: bold;
        color: #667eea;
    }
    .chart-container {
        height: 300px;
        padding: 20px;
    }
    .action-btn {
        width: 100%;
        margin-bottom: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="text-white mb-4">
                <i class="bi bi-speedometer2"></i> Panel de Control
            </h1>
        </div>
    </div>

    <!-- Métricas principales -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card dashboard-card">
                <div class="card-body text-center">
                    <i class="bi bi-database-fill-up text-primary fs-1"></i>
                    <h5 class="card-title mt-3">Datasets</h5>
                    <p class="metric-value">0</p>
                    <small class="text-muted">Conjuntos de datos cargados</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card dashboard-card">
                <div class="card-body text-center">
                    <i class="bi bi-cpu-fill text-success fs-1"></i>
                    <h5 class="card-title mt-3">Modelos</h5>
                    <p class="metric-value">0</p>
                    <small class="text-muted">Modelos entrenados</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card dashboard-card">
                <div class="card-body text-center">
                    <i class="bi bi-graph-up-arrow text-info fs-1"></i>
                    <h5 class="card-title mt-3">Precisión</h5>
                    <p class="metric-value">0%</p>
                    <small class="text-muted">Precisión promedio</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card dashboard-card">
                <div class="card-body text-center">
                    <i class="bi bi-lightning-fill text-warning fs-1"></i>
                    <h5 class="card-title mt-3">Predicciones</h5>
                    <p class="metric-value">0</p>
                    <small class="text-muted">Realizadas hoy</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Panel de acciones -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <i class="bi bi-gear-fill"></i> Acciones Rápidas
                </div>
                <div class="card-body">
                    <button class="btn btn-primary action-btn" data-bs-toggle="modal" data-bs-target="#uploadDatasetModal">
                        <i class="bi bi-upload"></i> Cargar Dataset
                    </button>
                    <button class="btn btn-success action-btn" data-bs-toggle="modal" data-bs-target="#trainModelModal">
                        <i class="bi bi-play-fill"></i> Entrenar Modelo
                    </button>
                    <button class="btn btn-info action-btn" data-bs-toggle="modal" data-bs-target="#makePredictionModal">
                        <i class="bi bi-cloud-fog2"></i> Hacer Predicción
                    </button>
                    <a href="/admin/" class="btn btn-secondary action-btn">
                        <i class="bi bi-shield-lock"></i> Administración
                    </a>
                </div>
            </div>
        </div>

        <!-- Gráficos -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <i class="bi bi-bar-chart-fill"></i> Rendimiento del Modelo
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de modelos recientes -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <i class="bi bi-clock-history"></i> Modelos Recientes
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Tipo</th>
                                    <th>Precisión</th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="5" class="text-center text-muted">No hay modelos entrenados aún</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Cargar Dataset -->
<div class="modal fade" id="uploadDatasetModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cargar Dataset</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="uploadDatasetForm">
                    <div class="mb-3">
                        <label for="datasetName" class="form-label">Nombre del Dataset</label>
                        <input type="text" class="form-control" id="datasetName" required>
                    </div>
                    <div class="mb-3">
                        <label for="datasetFile" class="form-label">Archivo CSV</label>
                        <input type="file" class="form-control" id="datasetFile" accept=".csv" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="uploadDataset()">Cargar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Entrenar Modelo -->
<div class="modal fade" id="trainModelModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Entrenar Nuevo Modelo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="trainModelForm">
                    <div class="mb-3">
                        <label for="modelName" class="form-label">Nombre del Modelo</label>
                        <input type="text" class="form-control" id="modelName" required>
                    </div>
                    <div class="mb-3">
                        <label for="modelType" class="form-label">Tipo de Modelo</label>
                        <select class="form-control" id="modelType" required>
                            <option value="">Seleccionar...</option>
                            <option value="random_forest">Random Forest</option>
                            <option value="lstm">LSTM</option>
                            <option value="gru">GRU</option>
                            <option value="xgboost">XGBoost</option>
                            <option value="gradient_boosting">Gradient Boosting</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="dataset" class="form-label">Dataset</label>
                        <select class="form-control" id="dataset" required>
                            <option value="">Seleccionar dataset...</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="trainModel()">Entrenar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Hacer Predicción -->
<div class="modal fade" id="makePredictionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Hacer Predicción</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="predictionForm">
                    <div class="mb-3">
                        <label for="predModel" class="form-label">Modelo</label>
                        <select class="form-control" id="predModel" required>
                            <option value="">Seleccionar modelo...</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="predData" class="form-label">Datos de Entrada (JSON)</label>
                        <textarea class="form-control" id="predData" rows="4" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="makePrediction()">Predecir</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Configuración del gráfico
const ctx = document.getElementById('performanceChart').getContext('2d');
const performanceChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
        datasets: [{
            label: 'Precisión del Modelo',
            data: [],
            borderColor: '#667eea',
            backgroundColor: 'rgba(102, 126, 234, 0.1)',
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: true
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: 100
            }
        }
    }
});

// Funciones para las acciones
function uploadDataset() {
    const name = document.getElementById('datasetName').value;
    const file = document.getElementById('datasetFile').files[0];
    
    if (!name || !file) {
        alert('Por favor complete todos los campos');
        return;
    }
    
    const formData = new FormData();
    formData.append('name', name);
    formData.append('file', file);
    
    fetch('/api/datasets/', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        alert('Dataset cargado exitosamente');
        location.reload();
    })
    .catch(error => {
        alert('Error al cargar el dataset: ' + error);
    });
}

function trainModel() {
    alert('Función de entrenamiento en desarrollo');
}

function makePrediction() {
    alert('Función de predicción en desarrollo');
}

// Cargar datos iniciales
document.addEventListener('DOMContentLoaded', function() {
    // Aquí se cargarían los datos reales de la API
    console.log('Dashboard cargado');
});
</script>
{% endblock %}